<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 7 Structurer ses tables | Préparer ses données avec R et le Tidyverse</title>
  <meta name="description" content="Préparation des données avec R et le Tidyverse (module 2)" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 7 Structurer ses tables | Préparer ses données avec R et le Tidyverse" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Préparation des données avec R et le Tidyverse (module 2)" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 7 Structurer ses tables | Préparer ses données avec R et le Tidyverse" />
  
  <meta name="twitter:description" content="Préparation des données avec R et le Tidyverse (module 2)" />
  

<meta name="author" content="Maël Theulière &amp; Bruno Terseur" />


<meta name="date" content="2022-01-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="manipuler-plusieurs-tables.html"/>
<link rel="next" href="exercice-6-les-données-majic.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.16/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><p style="text-align:center;"><img src="https://mtes-mct.github.io/parcours-r/assets/images/logo_marianne_fond_blanc.png" style="width:100px;"/></p></li>
<li><a href="./">Préparer ses données avec R et le Tidyverse</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#le-parcours-de-formation"><i class="fa fa-check"></i><b>1.1</b> Le parcours de formation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#objectifs-du-module-2"><i class="fa fa-check"></i><b>1.2</b> Objectifs du module 2</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="le-tidyverse.html"><a href="le-tidyverse.html"><i class="fa fa-check"></i><b>2</b> Le tidyverse</a>
<ul>
<li class="chapter" data-level="2.1" data-path="le-tidyverse.html"><a href="le-tidyverse.html#présentation-des-packages"><i class="fa fa-check"></i><b>2.1</b> Présentation des packages</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="le-tidyverse.html"><a href="le-tidyverse.html#des-packages-pour-lire-des-données"><i class="fa fa-check"></i><b>2.1.1</b> Des packages pour lire des données</a></li>
<li class="chapter" data-level="2.1.2" data-path="le-tidyverse.html"><a href="le-tidyverse.html#des-packages-pour-manipuler-des-données"><i class="fa fa-check"></i><b>2.1.2</b> Des packages pour manipuler des données</a></li>
<li class="chapter" data-level="2.1.3" data-path="le-tidyverse.html"><a href="le-tidyverse.html#des-packages-pour-nettoyer-des-données"><i class="fa fa-check"></i><b>2.1.3</b> Des packages pour nettoyer des données</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="le-tidyverse.html"><a href="le-tidyverse.html#les-spécificités-du-tidyverse"><i class="fa fa-check"></i><b>2.2</b> Les spécificités du tidyverse</a></li>
<li class="chapter" data-level="2.3" data-path="le-tidyverse.html"><a href="le-tidyverse.html#dautres-approches-possibles"><i class="fa fa-check"></i><b>2.3</b> D’autres approches possibles</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bien-commencer.html"><a href="bien-commencer.html"><i class="fa fa-check"></i><b>3</b> Bien commencer</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bien-commencer.html"><a href="bien-commencer.html#créer-un-projet-sous-rstudio-pour-vous-permettre-de-recencer-vos-travaux."><i class="fa fa-check"></i><b>3.1</b> Créer un projet sous Rstudio pour vous permettre de recencer vos travaux.</a></li>
<li class="chapter" data-level="3.2" data-path="bien-commencer.html"><a href="bien-commencer.html#intégrer-vos-données"><i class="fa fa-check"></i><b>3.2</b> Intégrer vos données</a></li>
<li class="chapter" data-level="3.3" data-path="bien-commencer.html"><a href="bien-commencer.html#créer-votre-arborescence-de-projet"><i class="fa fa-check"></i><b>3.3</b> Créer votre arborescence de projet</a></li>
<li class="chapter" data-level="3.4" data-path="bien-commencer.html"><a href="bien-commencer.html#utilisation-du-package-savoirfr"><i class="fa fa-check"></i><b>3.4</b> Utilisation du package savoirfR</a></li>
<li class="chapter" data-level="3.5" data-path="bien-commencer.html"><a href="bien-commencer.html#activer-les-packages-nécessaires"><i class="fa fa-check"></i><b>3.5</b> Activer les packages nécessaires</a></li>
<li class="chapter" data-level="3.6" data-path="bien-commencer.html"><a href="bien-commencer.html#bien-structurer-ses-projets-data"><i class="fa fa-check"></i><b>3.6</b> Bien structurer ses projets data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lire-des-données.html"><a href="lire-des-données.html"><i class="fa fa-check"></i><b>4</b> Lire des données</a>
<ul>
<li class="chapter" data-level="4.1" data-path="lire-des-données.html"><a href="lire-des-données.html#readxl-lire-des-données-excel"><i class="fa fa-check"></i><b>4.1</b> readxl : lire des données Excel</a></li>
<li class="chapter" data-level="4.2" data-path="lire-des-données.html"><a href="lire-des-données.html#read_delim-lire-des-fichiers-plats"><i class="fa fa-check"></i><b>4.2</b> read_delim : lire des fichiers plats</a></li>
<li class="chapter" data-level="4.3" data-path="lire-des-données.html"><a href="lire-des-données.html#télécharger-des-données-disponibles-sur-le-web"><i class="fa fa-check"></i><b>4.3</b> Télécharger des données disponibles sur le web</a></li>
<li class="chapter" data-level="4.4" data-path="lire-des-données.html"><a href="lire-des-données.html#lire-des-fichiers-avec-une-dimension-spatiale"><i class="fa fa-check"></i><b>4.4</b> Lire des fichiers avec une dimension spatiale</a></li>
<li class="chapter" data-level="4.5" data-path="lire-des-données.html"><a href="lire-des-données.html#lire-des-données-sous-postgresql"><i class="fa fa-check"></i><b>4.5</b> Lire des données sous PostgreSQL</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="lire-des-données.html"><a href="lire-des-données.html#lire-des-données-sous-postgresql-première-approche"><i class="fa fa-check"></i><b>4.5.1</b> Lire des données sous PostgreSQL : première approche</a></li>
<li class="chapter" data-level="4.5.2" data-path="lire-des-données.html"><a href="lire-des-données.html#lire-des-données-sous-postgresql-seconde-approche"><i class="fa fa-check"></i><b>4.5.2</b> Lire des données sous PostgreSQL : seconde approche</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="lire-des-données.html"><a href="lire-des-données.html#lire-des-données-du-webservice-insee"><i class="fa fa-check"></i><b>4.6</b> Lire des données du webservice Insee</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html"><i class="fa fa-check"></i><b>5</b> Manipuler des données</a>
<ul>
<li class="chapter" data-level="5.1" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#les-principes-des-fonctions-de-dplyr"><i class="fa fa-check"></i><b>5.1</b> Les principes des fonctions de <code>{dplyr}</code></a></li>
<li class="chapter" data-level="5.2" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#présentation-des-données"><i class="fa fa-check"></i><b>5.2</b> Présentation des données</a></li>
<li class="chapter" data-level="5.3" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#chargement-des-données"><i class="fa fa-check"></i><b>5.3</b> Chargement des données</a></li>
<li class="chapter" data-level="5.4" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#les-verbes-clefs-de-dplyr-pour-manipuler-une-table"><i class="fa fa-check"></i><b>5.4</b> Les verbes clefs de <code>{dplyr}</code> pour manipuler une table</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#sélectionner-des-variables-select"><i class="fa fa-check"></i><b>5.4.1</b> Sélectionner des variables : <code>select()</code></a></li>
<li class="chapter" data-level="5.4.2" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#trier-une-table-arrange"><i class="fa fa-check"></i><b>5.4.2</b> Trier une table : <code>arrange()</code></a></li>
<li class="chapter" data-level="5.4.3" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#renommer-une-variable-rename"><i class="fa fa-check"></i><b>5.4.3</b> Renommer une variable : <code>rename()</code></a></li>
<li class="chapter" data-level="5.4.4" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#filtrer-une-table-filter"><i class="fa fa-check"></i><b>5.4.4</b> Filtrer une table : <code>filter()</code></a></li>
<li class="chapter" data-level="5.4.5" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#modifierajouter-une-variable-mutate"><i class="fa fa-check"></i><b>5.4.5</b> Modifier/ajouter une variable : <code>mutate()</code></a></li>
<li class="chapter" data-level="5.4.6" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#extraire-un-vecteur-pull"><i class="fa fa-check"></i><b>5.4.6</b> Extraire un vecteur : <code>pull()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#la-boîte-à-outils-pour-créer-et-modifier-des-variables-avec-r"><i class="fa fa-check"></i><b>5.5</b> La boîte à outils pour créer et modifier des variables avec R</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#manipuler-des-variables-numériques"><i class="fa fa-check"></i><b>5.5.1</b> Manipuler des variables numériques</a></li>
<li class="chapter" data-level="5.5.2" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#exercice-1-les-données-mensuelles-sitadel"><i class="fa fa-check"></i><b>5.5.2</b> Exercice 1 : Les données mensuelles sitadel</a></li>
<li class="chapter" data-level="5.5.3" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#manipuler-des-dates"><i class="fa fa-check"></i><b>5.5.3</b> Manipuler des dates</a></li>
<li class="chapter" data-level="5.5.4" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#manipuler-des-chaînes-de-caractères"><i class="fa fa-check"></i><b>5.5.4</b> Manipuler des chaînes de caractères</a></li>
<li class="chapter" data-level="5.5.5" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#manipuler-des-variables-factorielles-qualitatives-ou-catégorielles"><i class="fa fa-check"></i><b>5.5.5</b> Manipuler des variables factorielles ( = qualitatives ou catégorielles)</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#aggréger-des-données-summarise"><i class="fa fa-check"></i><b>5.6</b> Aggréger des données : <code>summarise()</code></a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#quelques-fonctions-daggrégations-utiles"><i class="fa fa-check"></i><b>5.6.1</b> Quelques fonctions d’aggrégations utiles</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#aggréger-des-données-par-dimension-group_by"><i class="fa fa-check"></i><b>5.7</b> Aggréger des données par dimension : <code>group_by()</code></a></li>
<li class="chapter" data-level="5.8" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#le-pipe"><i class="fa fa-check"></i><b>5.8</b> Le pipe</a></li>
<li class="chapter" data-level="5.9" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#la-magie-des-opérations-groupées"><i class="fa fa-check"></i><b>5.9</b> La magie des opérations groupées</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#exercice-3"><i class="fa fa-check"></i><b>5.9.1</b> Exercice 3</a></li>
<li class="chapter" data-level="5.9.2" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#exercice-4"><i class="fa fa-check"></i><b>5.9.2</b> Exercice 4</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#les-armes-non-conventionnelles-de-la-préparation-des-donnéees"><i class="fa fa-check"></i><b>5.10</b> Les armes non conventionnelles de la préparation des donnéees</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#les-select-helpers"><i class="fa fa-check"></i><b>5.10.1</b> Les select helpers</a></li>
<li class="chapter" data-level="5.10.2" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#utiliser-les-select-helpers-avec-les-autres-verbes-du-tidyverse"><i class="fa fa-check"></i><b>5.10.2</b> Utiliser les select helpers avec les autres verbes du tidyverse</a></li>
<li class="chapter" data-level="5.10.3" data-path="manipuler-des-données.html"><a href="manipuler-des-données.html#filter-mutate-group_by-summarise-arrange-transmute"><i class="fa fa-check"></i><b>5.10.3</b> filter(), mutate(), group_by(), summarise(), arrange(), transmute()…</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="manipuler-plusieurs-tables.html"><a href="manipuler-plusieurs-tables.html"><i class="fa fa-check"></i><b>6</b> Manipuler plusieurs tables</a>
<ul>
<li class="chapter" data-level="6.1" data-path="manipuler-plusieurs-tables.html"><a href="manipuler-plusieurs-tables.html#exercice-5"><i class="fa fa-check"></i><b>6.1</b> Exercice 5</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="structurer-ses-tables.html"><a href="structurer-ses-tables.html"><i class="fa fa-check"></i><b>7</b> Structurer ses tables</a>
<ul>
<li class="chapter" data-level="7.1" data-path="structurer-ses-tables.html"><a href="structurer-ses-tables.html#pourquoi-se-pencher-sur-la-structuration-des-tables"><i class="fa fa-check"></i><b>7.1</b> Pourquoi se pencher sur la structuration des tables ?</a></li>
<li class="chapter" data-level="7.2" data-path="structurer-ses-tables.html"><a href="structurer-ses-tables.html#les-deux-fonctions-clefs-de-tidyr"><i class="fa fa-check"></i><b>7.2</b> Les deux fonctions clefs de <code>{tidyr}</code></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exercice-6-les-données-majic.html"><a href="exercice-6-les-données-majic.html"><i class="fa fa-check"></i><b>8</b> Exercice 6 : les données majic</a></li>
<li class="chapter" data-level="9" data-path="aller-plus-loin.html"><a href="aller-plus-loin.html"><i class="fa fa-check"></i><b>9</b> Aller plus loin</a></li>
<li class="divider"></li>
<li><a href="https://mtes-mct.github.io/parcours-r/">Liste des formations R</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Préparer ses données avec R et le Tidyverse</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="structurer-ses-tables" class="section level1" number="7">
<h1><span class="header-section-number">Chapitre 7</span> Structurer ses tables</h1>
<div id="pourquoi-se-pencher-sur-la-structuration-des-tables" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Pourquoi se pencher sur la structuration des tables ?</h2>
<p>Pour bien manipuler des données, leur structuration est fondamentale. Il faut bien savoir ce qu’est :</p>
<ul>
<li>une ligne de notre table,<br />
</li>
<li>une colonne de notre table.</li>
</ul>
<p>Sur une table non aggrégée (un répertoire, une table d’enquête…), la structuration naturelle est une ligne par observation (un individu, une entreprise…), une colonne par variable (âge, taille…) sur cette observation.</p>
<p>Mais dès qu’on aggrège une telle table pour construire des tables structurées par dimensions d’analyse et indicateurs, se pose toujours la question de savoir ce qu’on va considérer comme des dimensions et comme des indicateurs. Le standard <strong>tidy data</strong> définit 3 principes pour des données <strong>propres</strong> :</p>
<ul>
<li>chaque variable est une colonne,<br />
</li>
<li>chaque observation est une ligne,<br />
</li>
<li>les unités d’observations différentes sont stockées dans des tables différentes.</li>
</ul>
<p>Le respect de ces règles va nous amener parfois à devoir changer la définition des lignes et colonnes de nos tables en entrée.</p>
<p>Ci-dessous un exemple simple : la population estimée par département et genre en 2019. Ce fichier est un extrait d’un tableur <a href="https://www.insee.fr/fr/statistiques/1893198">mis à disposition par l’Insee</a>.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="structurer-ses-tables.html#cb125-1" aria-hidden="true" tabindex="-1"></a>estim_pop <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&#39;extdata/estim-pop-dep-sexe-gca-2019.xls&#39;</span>)</span>
<span id="cb125-2"><a href="structurer-ses-tables.html#cb125-2" aria-hidden="true" tabindex="-1"></a>estim_pop</span></code></pre></div>
<pre><code>## # A tibble: 104 x 20
##    dep   lib_dep Ensemble_019ans Ensemble_2039ans Ensemble_4059ans
##    &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 01    Ain              167720           150949           179476
##  2 02    Aisne            131435           115046           137405
##  3 03    Allier            67628            61986            87232
##  4 04    Alpes-…           33883            30028            43039
##  5 05    Hautes…           30518            28633            37887
##  6 06    Alpes-…          228072           237427           282270
##  7 07    Ardèche           71385            62186            88572
##  8 08    Ardenn…           61006            56583            71821
##  9 09    Ariège            31143            28962            41017
## 10 10    Aube              74510            69537            78475
## # … with 94 more rows, and 15 more variables: Ensemble_6074ans &lt;dbl&gt;,
## #   Ensemble_75ansetplus &lt;dbl&gt;, Ensemble_Total &lt;dbl&gt;, Homme_019ans &lt;dbl&gt;,
## #   Homme_2039ans &lt;dbl&gt;, Homme_4059ans &lt;dbl&gt;, Homme_6074ans &lt;dbl&gt;,
## #   Homme_75ansetplus &lt;dbl&gt;, Homme_Total &lt;dbl&gt;, Femme_019ans &lt;dbl&gt;,
## #   Femme_2039ans &lt;dbl&gt;, Femme_4059ans &lt;dbl&gt;, Femme_6074ans &lt;dbl&gt;,
## #   Femme_75ansetplus &lt;dbl&gt;, Femme_Total &lt;dbl&gt;</code></pre>
<p>En quoi ce fichier n’est pas <strong>tidy</strong> ?</p>
<p>On retrouve 4 variables dans notre fichier : le territoire, le genre, l’âge et la population, et nos colonnes ne correspondent pas à ces variables.</p>
<p>Quel serait la version <em>tidy</em> de notre fichier ?</p>
<pre><code>## # A tibble: 1,872 x 5
##    dep   lib_dep genre    age         nombre_individus
##    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;                  &lt;dbl&gt;
##  1 01    Ain     Ensemble 019ans                167720
##  2 01    Ain     Ensemble 2039ans               150949
##  3 01    Ain     Ensemble 4059ans               179476
##  4 01    Ain     Ensemble 6074ans               102788
##  5 01    Ain     Ensemble 75ansetplus            52755
##  6 01    Ain     Ensemble Total                 653688
##  7 01    Ain     Homme    019ans                 86359
##  8 01    Ain     Homme    2039ans                75242
##  9 01    Ain     Homme    4059ans                89278
## 10 01    Ain     Homme    6074ans                49523
## # … with 1,862 more rows</code></pre>
<p>Comment passer facilement d’un format <strong>non tidy</strong> à un format <strong>tidy</strong> ? C’est là qu’intervient le package <code>{tidyr}</code>.</p>
</div>
<div id="les-deux-fonctions-clefs-de-tidyr" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Les deux fonctions clefs de <code>{tidyr}</code></h2>
<ul>
<li><code>pivot.longer()</code> permet d’empiler plusieurs colonnes (correspondant à des variables quantitatives). Elles sont repérées par création d’une variable qualitative, à partir de leurs noms. Le résultat est une table au <strong>format long</strong>.</li>
</ul>
<center>
<img src="images/gather.png" />
</center>
<ul>
<li><code>pivot.wider()</code> fait l’inverse. Cette fonction crée autant de colonnes qu’il y a de modalités d’une variable qualitative, en remplissant chacune par le contenu d’une variable numérique. Le résultat est une table au <strong>format large</strong>.</li>
</ul>
<center>
<img src="images/spread.png" />
</center>
<p>Pour avoir un apperçu illustré de ces fonctions, voir <a href="https://www.dropbox.com/s/a6o75zj443b2rv3/tidyr-longer-wider-modified.gif?dl=0">cette animation</a></p>
<p>Reprenons notre table Insee d’estimation de population. Comment faire pour passer cette table dans le format <em>tidy</em> ?</p>
<p>Première étape, retrouvons notre colonne <code>population</code>. Pour cela, il nous faut passer notre table au <em>format long</em>, grace à <code>pivot_longer()</code>.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="structurer-ses-tables.html#cb128-1" aria-hidden="true" tabindex="-1"></a>estim_pop_tidy <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&#39;extdata/estim-pop-dep-sexe-gca-2019.xls&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-2"><a href="structurer-ses-tables.html#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(dep,lib_dep), <span class="at">values_to =</span> <span class="st">&quot;nombre_individus&quot;</span>, <span class="at">names_to =</span> <span class="st">&quot;genre_age&quot;</span>)</span></code></pre></div>
<p>Si nous voulions retrouver le format <em>large</em>, nous pourrions utiliser <code>pivot_wider()</code></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="structurer-ses-tables.html#cb129-1" aria-hidden="true" tabindex="-1"></a>estim_pop_nontidy <span class="ot">&lt;-</span> estim_pop_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb129-2"><a href="structurer-ses-tables.html#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> genre_age, <span class="at">values_from =</span> nombre_individus)</span></code></pre></div>
<p>Nous n’avons pas encore retrouvé nos deux variables <code>genre</code> et <code>age</code>, mais une seule variable mélange les deux.
Pour cela, nous pouvons utiliser <code>separate()</code> du package <code>{tidyr}</code>.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="structurer-ses-tables.html#cb130-1" aria-hidden="true" tabindex="-1"></a>estim_pop_tidy <span class="ot">&lt;-</span> estim_pop_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb130-2"><a href="structurer-ses-tables.html#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(genre_age, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;genre&quot;</span>,<span class="st">&quot;age&quot;</span>))</span></code></pre></div>
<p>Mais <code>pivot_longer()</code> permet d’aller encore plus loin en spécifiant sur nos colonnes un moyen de distinguer nos deux variables directement avec l’argument <code>names_sep</code>.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="structurer-ses-tables.html#cb131-1" aria-hidden="true" tabindex="-1"></a>estim_pop_tidy <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&#39;extdata/estim-pop-dep-sexe-gca-2019.xls&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb131-2"><a href="structurer-ses-tables.html#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(dep, lib_dep), <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>, <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;genre&quot;</span>, <span class="st">&quot;age&quot;</span>), </span>
<span id="cb131-3"><a href="structurer-ses-tables.html#cb131-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;nombre_individus&quot;</span>)</span></code></pre></div>
<p>Et <code>pivot_wider()</code> permet également d’utiliser deux variables pour définir les modalités à <em>convertir</em> en colonnes.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="structurer-ses-tables.html#cb132-1" aria-hidden="true" tabindex="-1"></a>estim_pop_nontidy <span class="ot">&lt;-</span> estim_pop_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb132-2"><a href="structurer-ses-tables.html#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(genre,age), <span class="at">values_from =</span> nombre_individus)</span></code></pre></div>
<p>Vous retrouverez une introduction complète à <code>{tidyr}</code> dans un <a href="https://tidyr.tidyverse.org/articles/pivot.html">article très bien fait</a> de la documentation du package (en anglais).</p>
<p><code>{tidyr}</code> permet également de transformer des données sous forme de listes en dataframe <strong>tidy</strong> très simplement.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="manipuler-plusieurs-tables.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercice-6-les-données-majic.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Preparer-ses-donnees-avec-R-et-le-Tidyverse.pdf", "Preparer-ses-donnees-avec-R-et-le-Tidyverse.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
